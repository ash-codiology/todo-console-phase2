(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{6840:function(t,e,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return o(4807)}])},834:function(t,e,o){"use strict";o.d(e,{H:function(){return i},a:function(){return c}});var n=o(5893),s=o(7294),r=o(9357);let a=(0,s.createContext)(void 0),c=()=>{let t=(0,s.useContext)(a);if(!t)throw Error("useAuth must be used within an AuthProvider");return t},i=t=>{let{children:e}=t,[o,c]=(0,s.useState)(null),[i,u]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let t=localStorage.getItem("user"),e=localStorage.getItem("token")||localStorage.getItem("access_token");t&&e&&(c(JSON.parse(t)),r.E.setToken(e)),u(!1)},[]);let l=async(t,e)=>{u(!0);try{let o=await r.E.signin(t,e),n={id:o.user_id,email:t};c(n),localStorage.setItem("user",JSON.stringify(n)),localStorage.setItem("token",o.access_token),localStorage.setItem("access_token",o.access_token),r.E.setToken(o.access_token)}catch(t){throw console.error("Signin failed:",t),t}finally{u(!1)}},h=async(t,e)=>{u(!0);try{let o=await r.E.signup(t,e),n={id:o.user_id,email:t};c(n),localStorage.setItem("user",JSON.stringify(n)),localStorage.setItem("token",o.access_token),localStorage.setItem("access_token",o.access_token),r.E.setToken(o.access_token)}catch(t){throw console.error("Signup failed:",t),t}finally{u(!1)}};return(0,n.jsx)(a.Provider,{value:{user:o,loading:i,signIn:l,signUp:h,signOut:()=>{c(null),localStorage.removeItem("user"),localStorage.removeItem("token"),localStorage.removeItem("access_token"),r.E.setToken(null)}},children:e})}},4807:function(t,e,o){"use strict";o.r(e);var n=o(5893);o(2352);var s=o(834);e.default=function(t){let{Component:e,pageProps:o}=t;return(0,n.jsx)(s.H,{children:(0,n.jsx)(e,{...o})})}},9357:function(t,e,o){"use strict";o.d(e,{E:function(){return s}});class n{setToken(t){this.token=t}async request(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=localStorage.getItem("token")||localStorage.getItem("access_token");o&&(this.token=o);let n="".concat("http://localhost:8000/api").concat(t),s={"Content-Type":"application/json",...e.headers};o&&(s.Authorization="Bearer ".concat(o));let r={headers:s,...e};try{let t=await fetch(n,r);if(!t.ok){if(401===t.status){let t=localStorage.getItem("token")||localStorage.getItem("access_token");if(t&&t!==o){this.token=t,s.Authorization="Bearer ".concat(t);let e=await fetch(n,{...r,headers:s});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.detail||"HTTP error! status: ".concat(e.status))}return await e.json()}}let e=await t.json().catch(()=>({}));throw Error(e.detail||"HTTP error! status: ".concat(t.status))}return await t.json()}catch(e){throw console.error("API request failed: ".concat(t),e),e}}async signup(t,e){return this.request("/auth/signup",{method:"POST",body:JSON.stringify({email:t,password:e})})}async signin(t,e){let o=await this.request("/auth/signin",{method:"POST",body:JSON.stringify({email:t,password:e})});return o.access_token&&this.setToken(o.access_token),o}async getTodos(){return this.request("/todos")}async getTodo(t){return this.request("/todos/".concat(t))}async createTodo(t,e){return this.request("/todos",{method:"POST",body:JSON.stringify({title:t,description:e})})}async updateTodo(t,e,o,n){return this.request("/todos/".concat(t),{method:"PUT",body:JSON.stringify({title:e,description:o,completed:n})})}async deleteTodo(t){return this.request("/todos/".concat(t),{method:"DELETE"})}async toggleTodoCompletion(t){return this.request("/todos/".concat(t,"/toggle"),{method:"PATCH"})}constructor(){this.token=null}}let s=new n},2352:function(){}},function(t){var e=function(e){return t(t.s=e)};t.O(0,[774,179],function(){return e(6840),e(9974)}),_N_E=t.O()}]);